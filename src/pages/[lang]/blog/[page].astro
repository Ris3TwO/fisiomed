---
import PostsPage from "@/components/pages/PostsPage.astro";
import { LOCALES } from "@/i18n/config";
import { getAllPosts } from "@/services/wordpress/wp";
import type { GetStaticPathsOptions } from "astro";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const allRoutes = [];

  for (const lang of LOCALES) {
    try {
      const allPosts = await getAllPosts(lang);

      const paginatedRoutes = paginate(allPosts, {
        pageSize: 10,
        params: { lang },
      });

      allRoutes.push(...paginatedRoutes);
    } catch (error) {
      throw error;
    }
  }

  return allRoutes;
}

const { page } = Astro.props;

const { lang } = Astro.params;

const props = { lang, page };

export const prerender = true;
---

<PostsPage {...props} />
